{% extends base_template %}
{% load static %}
{% load dispatch_tags %}
{% load dispatch_filters %}
{% block header %}
    {% include 'headers/topbar.html' with article=article section=article.section.slug %}
    {% include 'headers/mobile.html' %}
{% endblock %}
{% block content %}
<main id="article-{{ article.parent_id }}" class="article">
  {% block banner_ad %}
  {% if explicit is not True %}
  {% include 'objects/advertisement.html' with size='leaderboard' name='Leaderboard' id=1 article=article.id %}
  {% include 'objects/advertisement.html' with size='mobile-leaderboard' name='Mobile_Leaderboard' id=2 article=article.id %}
  {% endif %}
  {% endblock %}
  <article class="c-article c-article--{{ article.template }} js-article" {% if user.is_authenticated %}data-user-id="{{ user.id }}"{% endif %} data-id="{{ article.parent_id }}" data-list="{{ reading_list.ids }}" data-list-name="{{ reading_list.name }}" data-headline="{{ article.headline }}" data-author="{{ authors_json }}" data-section="{{ article.section.slug }}" data-url="{{ article.get_absolute_url }}" data-explicit="{{ explicit }}">
  {% block banner %}
    {% if breaking %}
    <div class="u-container">
      <a class="o-breaking-news-article" href="{{ breaking.get_absolute_url }}">
        <h3>BREAKING: {{ breaking.headline|safe }}</h3>
      </a>
    </div>
    {% endif %}
    <div class="u-container u-container--content u-container--padded">
      <h1 class="o-headline o-headline--article">{{ article.headline|safe }}</h1>
      <div class="c-article__info">
        <div class="c-article__byline">
          <div class="c-article__author">{{ article.get_author_type_string|safe }}</div>
          <div class="c-article__byline__meta">
            <span class="c-article__published-at">{{ article.published_at|date:'N j, Y' }}</span>
            {% if reading_time %}
            <span> &nbsp;&middot;&nbsp; </span>
            <span class="c-article__reading-time">{{ reading_time }} min read</span>
            {% endif %}
          </div>
        </div>
        {% include 'objects/social-icons.html' with article=article layout='top' %}
      </div>
    </div>
  {% endblock %}
    <div class="u-container clearfix {% if article.template_fields.header_layout %}{{ article.template }}{% endif %}">
      {% block right-column %}
      <div class="right-column">
        {% if article.featured_image %}
        <div class="featured-media">
          <img class="article-attachment" data-id="{{ article.featured_image.id }}" data-caption="{% if article.featured_image.caption %}{{ article.featured_image.caption }}{% endif %}" data-credit="{% if article.featured_image.credit %}{{ article.featured_image.credit }}{% endif %}" data-url="{{ article.featured_image.image.get_absolute_url }}" src="{{ article.featured_image.image.get_medium_url }}"/>
          {% if article.featured_image.caption or article.featured_image.credit %}
          <div class="caption">
            {% if article.featured_image.caption %}{{ article.featured_image.caption }}{% endif %} {% if article.featured_image.credit %}<span class="credit">{{ article.featured_image.credit }}{% if not article.featured_image.has_custom_credit %}{% endif %}</span>{% endif %}
          </div>
          {% endif %}
        </div>
        <div class="sidebar offset">
        {% elif article.featured_video %}
        <div class="featured-media">
          <iframe 
            width="500px" 
            height="281px" 
            allowfullscreen="allowfullscreen"
            mozallowfullscreen="mozallowfullscreen" 
            msallowfullscreen="msallowfullscreen" 
            oallowfullscreen="oallowfullscreen" 
            webkitallowfullscreen="webkitallowfullscreen"
            src="{{ article.featured_video.video.url|youtube_embed_url|safe }}"></iframe>
          {% if article.featured_video.caption or article.featured_video.credit %}
          <div class="caption">
            {% if article.featured_video.caption %}{{ article.featured_video.caption }}{% endif %} {% if article.featured_video.credit %}<span class="credit">{{ article.featured_video.credit }}{% if not article.featured_video.has_custom_credit %}{% endif %}</span>{% endif %}
          </div>
          {% endif %}
        </div>
        <div class="sidebar offset">
        {% else %}
        <div class="sidebar">
        {% endif %}
          {% zone 'article-sidebar' %}
          {% if explicit is not True %}
            {% if reading_time >= 3 %}
              {% include 'objects/advertisement.html' with size='skyscraper' name='Box_A' id=3 article=article.id %}
              {% include 'objects/advertisement.html' with size='box' name='Box_B' id=4 article=article.id %}
            {% else %}
              {% include 'objects/advertisement.html' with size='box' name='Box_A' id=3 article=article.id %}
            {% endif %}
          {% else %}
            {% include 'objects/replacement.html' with size='box' %}
          {% endif %}
        </div>
      </div>
      {% endblock %}
      <div class="article-content">
      {% block pre-content %}{% endblock %}
        {{ article.html|safe }}
      </div>

      {% include 'objects/social-icons-bottom.html' with article=article %}
  </article>
</main>

{% zone 'article-horizontal' %}
<div class="slideshow">
  <div class="image-container">
    <div class="image-inner">
      <div class="slide">
        <img class="slide-image" />
        <p class="slide-caption"></p>
        <div class="navigation">
          <a class="prev-slide" href="#"><i class="fa fa-chevron-left"></i></a>
          <span class="curr-slide"></span> &nbsp; of &nbsp; <span class="total-slide"></span>
          <a class="next-slide" href="#"><i class="fa fa-chevron-right"></i></a>
        </div>
      </div>
    </div>
  </div>
</div>
<div id="gallery"></div>

{% include 'objects/bottom-banner.html' with article=article %}

{% endblock %}

{% block scripts %}
<script src="https://d3js.org/d3.v3.min.js"></script>
<style>
  .interactive-map-container {
    overflow: hidden;
  }
</style>
<script>
    let svg = d3.select('.svg-map'),
      width = +svg.node().getBoundingClientRect().width,
      height = +svg.node().getBoundingClientRect().height;

    console.log(svg);
    console.log(height);
    console.log(width);

    // svg.append("rect")
    //   .attr("fill", "none")
    //   .attr("pointer-events", "all")
    //   .attr("width", width)
    //   .attr("height", height)
    //   .call(d3.zoom()
    //     .scaleExtent([1, 8])
    //     .on("zoom", zoom));
        
    var zoom = d3.behavior.zoom()
      // only scale up, e.g. between 1x and 50x
      .scaleExtent([1, 10])
      .on("zoom", function() {
        var e = d3.event;
        console.log(e)
        // now, constrain the x and y components of the translation by the
        // dimensions of the viewport

        var tx = Math.min(0, Math.max(e.translate[0], width - width * e.scale * 2));
        var ty = Math.min(0, Math.max(e.translate[1], height - height * e.scale * 2));
            // then, update the zoom behavior's internal translation, so that
            // it knows how to properly manipulate it on the next movement
            zoom.translate([tx, ty]);
            // and finally, update the <g> element's transform attribute with the
            // correct translation and scale (in reverse order)
            svg.attr("transform", [
              "translate(" + [tx, ty] + ")",
              "scale(" + e.scale + ")"
            ].join(" "));
      })

    svg.call(zoom);
  </script>

{% endblock %}


<!-- Article-specific scripts -->
{% for s in article.scripts.all %}
<script src="http://localhost:8888/resources/js/{{ s.filename }}"></script>
{% endfor %}